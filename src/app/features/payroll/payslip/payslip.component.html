<div class="payslip-wrapper">
  <!-- Torna alla home -->
  <a routerLink="/dashboard" class="back-arrow">
    <svg class="arrow-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" />
    </svg>
    Torna alla Home
  </a>

  <form [formGroup]="form" (ngSubmit)="onSubmit()" class="payslip-card">
    <h2 class="card-title">La Tua Busta Paga</h2>

    <!-- ID utente nascosto -->
    <input type="hidden" formControlName="empId" />

    <!-- Mese -->
    <div class="form-row">
      <label for="month" class="row-label">Mese</label>
      <select id="month" formControlName="month">
        <option value="" disabled>— Seleziona mese —</option>
        <option *ngFor="let m of months" [value]="m.value">
          {{ m.label }}
        </option>
      </select>
      <small *ngIf="form.get('month')?.hasError('required') && form.touched" class="error">
        Devi scegliere un mese
      </small>
    </div>

    <!-- Pulsante -->
    <div class="form-actions">
      <button type="submit" class="btn-submit" [disabled]="loading">
        {{ loading ? 'Calcolo in corso…' : 'Mostra Busta Paga' }}
      </button>
    </div>

    <!-- Errore -->
    <div *ngIf="error" class="alert-error">{{ error }}</div>

    <!-- Risultato raw -->
<table *ngIf="rawResult" class="result-table">
  <tr *ngFor="let kv of rawResult | keyvalue">
    <th>{{ kv.key }}</th>
    <td>{{ kv.value }}</td>
  </tr>
</table>


    <!-- Busta paga calcolata -->
    <div *ngIf="payslip" class="payslip-result">
      <h3>Dettaglio Calcolato</h3>
      <table class="result-table">
        <tr>
          <th>Lordo</th>
          <td>{{ payslip.lordo | currency:'EUR' }}</td>
        </tr>
        <tr>
          <th>Contributi INPS</th>
          <td>{{ payslip.contributi | currency:'EUR' }}</td>
        </tr>
        <tr>
          <th>Imponibile fiscale</th>
          <td>{{ payslip.imponibile | currency:'EUR' }}</td>
        </tr>
        <tr>
          <th>Tasse IRPEF</th>
          <td>{{ payslip.tasse | currency:'EUR' }}</td>
        </tr>
        <tr>
          <th>Netto a pagare</th>
          <td class="netto">{{ payslip.netto | currency:'EUR' }}</td>
        </tr>
      </table>
    </div>
  </form>
</div>
